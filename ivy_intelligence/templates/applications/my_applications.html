{% extends 'base/base.html' %}
{% block title %}My Applications â€” Ivy Intelligence{% endblock %}
{% block content %}
<div class="container py-4">
    <h3 class="fw-bold mb-4" style="color: var(--ivy-blue);">My Applications</h3>

    <!-- Stats -->
    <div class="row g-3 mb-4">
        <div class="col-6 col-md-3">
            <div class="card p-3 text-center">
                <div class="fw-bold fs-4">{{ status_counts.total }}</div>
                <div class="text-muted small">Total</div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card p-3 text-center">
                <div class="fw-bold fs-4 text-primary">{{ status_counts.submitted }}</div>
                <div class="text-muted small">Submitted</div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card p-3 text-center">
                <div class="fw-bold fs-4 text-warning">{{ status_counts.shortlisted }}</div>
                <div class="text-muted small">Shortlisted</div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card p-3 text-center">
                <div class="fw-bold fs-4 text-success">{{ status_counts.selected }}</div>
                <div class="text-muted small">Selected ðŸŽ‰</div>
            </div>
        </div>
    </div>

    {% if applications %}
    <div class="card">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead style="background: #f4f7fb;">
                    <tr>
                        <th class="ps-3">Opportunity</th>
                        <th>University</th>
                        <th>Domain</th>
                        <th>Status</th>
                        <th>Auto-filled</th>
                        <th>Applied</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for app in applications %}
                    <tr>
                        <td class="ps-3">
                            <a href="{% url 'opportunity_detail' app.opportunity.pk %}" class="text-decoration-none fw-bold text-dark">
                                {{ app.opportunity.title|truncatewords:8 }}
                            </a>
                        </td>
                        <td class="small text-muted">{{ app.opportunity.get_university_display }}</td>
                        <td><span class="domain-badge domain-{{ app.opportunity.domain }}">{{ app.opportunity.domain }}</span></td>
                        <td>
                            <span class="badge
                                {% if app.status == 'SELECTED' %}bg-success
                                {% elif app.status == 'SHORTLISTED' %}bg-warning text-dark
                                {% elif app.status == 'REJECTED' %}bg-danger
                                {% elif app.status == 'WITHDRAWN' %}bg-secondary
                                {% else %}bg-primary{% endif %}">
                                {{ app.get_status_display }}
                            </span>
                        </td>
                        <td>{% if app.auto_submitted %}<i class="bi bi-check-circle text-success"></i>{% else %}â€”{% endif %}</td>
                        <td class="small text-muted">{{ app.applied_at|date:"M d, Y" }}</td>
                        <td>
                            {% if app.status in 'PENDING,SUBMITTED' %}
                            <a href="{% url 'withdraw_application' app.id %}"
                               onclick="return confirm('Withdraw this application?')"
                               class="btn btn-sm btn-outline-danger">Withdraw</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="text-center py-5">
        <i class="bi bi-file-text" style="font-size:3rem; color:#ccc;"></i>
        <h5 class="mt-3 text-muted">No applications yet</h5>
        <a href="{% url 'dashboard' %}" class="btn btn-primary mt-2">Browse Opportunities</a>
    </div>
    {% endif %}
</div>
{% endblock %}
