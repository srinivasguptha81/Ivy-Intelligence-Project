{% extends 'base/base.html' %}
{% block title %}{{ profile_user.username }} ‚Äî Ivy Intelligence{% endblock %}
{% block content %}
<div class="container py-4">
    <div class="row g-4">
        <!-- Left: Profile Card -->
        <div class="col-lg-4">
            <div class="card p-4 text-center">
                {% if profile.avatar %}
                <img src="{{ profile.avatar.url }}" class="rounded-circle mb-3" style="width:100px;height:100px;object-fit:cover;">
                {% else %}
                <div style="width:100px;height:100px;background:var(--ivy-blue);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 1rem;font-size:2rem;color:white;">
                    {{ profile_user.username.0|upper }}
                </div>
                {% endif %}
                <h4 class="fw-bold mb-0">{{ profile_user.get_full_name|default:profile_user.username }}</h4>
                <p class="text-muted">@{{ profile_user.username }}</p>

                <!-- InCoScore Ring -->
                <div class="score-ring mb-3" title="InCoScore">
                    {{ profile.incoscore|floatformat:1 }}
                </div>
                <p class="text-muted small">InCoScore</p>

                {% if profile.university %}
                <p class="mb-1"><i class="bi bi-building me-2 text-primary"></i>{{ profile.university }}</p>
                {% endif %}
                {% if profile.year_of_study %}
                <p class="mb-1 small text-muted">{{ profile.get_year_of_study_display }}</p>
                {% endif %}
                {% if profile.cgpa %}
                <p class="mb-2 small"><span class="badge bg-light text-dark">CGPA: {{ profile.cgpa }}/10</span></p>
                {% endif %}

                {% if profile.bio %}
                <p class="text-muted small mt-2">{{ profile.bio }}</p>
                {% endif %}

                <div class="d-flex justify-content-center gap-2 mt-3">
                    {% if profile.linkedin_url %}<a href="{{ profile.linkedin_url }}" target="_blank" class="btn btn-sm btn-outline-primary"><i class="bi bi-linkedin"></i></a>{% endif %}
                    {% if profile.github_url %}<a href="{{ profile.github_url }}" target="_blank" class="btn btn-sm btn-outline-dark"><i class="bi bi-github"></i></a>{% endif %}
                    {% if profile.resume %}<a href="{{ profile.resume.url }}" target="_blank" class="btn btn-sm btn-outline-secondary"><i class="bi bi-file-pdf me-1"></i>Resume</a>{% endif %}
                </div>

                {% if is_own_profile %}
                <a href="{% url 'profile_edit' %}" class="btn btn-primary btn-sm w-100 mt-3">
                    <i class="bi bi-pencil me-1"></i>Edit Profile
                </a>
                {% endif %}
            </div>

            <!-- Skills -->
            {% if profile.skills %}
            <div class="card p-3 mt-3">
                <h6 class="fw-bold mb-2">Skills</h6>
                {% for skill in profile.skills %}
                <span class="badge bg-light text-dark me-1 mb-1">{{ skill }}</span>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Domain Interests -->
            {% if profile.domains_of_interest %}
            <div class="card p-3 mt-3">
                <h6 class="fw-bold mb-2">Domain Interests</h6>
                {% for d in profile.domains_of_interest %}
                <span class="domain-badge domain-{{ d }} me-1 mb-1 d-inline-block">{{ d }}</span>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <!-- Right: Activity -->
        <div class="col-lg-8">
            <!-- Stats row -->
            <div class="row g-3 mb-4">
                <div class="col-4">
                    <div class="card p-3 text-center">
                        <div class="fw-bold fs-4" style="color: var(--ivy-blue);">{{ applications_count }}</div>
                        <div class="text-muted small">Applications</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card p-3 text-center">
                        <div class="fw-bold fs-4" style="color: var(--ivy-blue);">{{ achievements.count }}</div>
                        <div class="text-muted small">Achievements</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card p-3 text-center">
                        <div class="fw-bold fs-4" style="color: var(--ivy-blue);">{{ profile.incoscore|floatformat:1 }}</div>
                        <div class="text-muted small">InCoScore</div>
                    </div>
                </div>
            </div>

            <!-- Achievements -->
            {% if achievements %}
            <div class="card p-4 mb-4">
                <h5 class="fw-bold mb-3"><i class="bi bi-trophy me-2 text-warning"></i>Verified Achievements</h5>
                {% for achievement in achievements %}
                <div class="d-flex align-items-start mb-3 pb-3 border-bottom">
                    <div class="me-3" style="font-size:1.5rem;">
                        {% if achievement.category == 'RESEARCH' %}üìÑ
                        {% elif achievement.category == 'HACKATHON' %}üèÜ
                        {% elif achievement.category == 'INTERNSHIP' %}üíº
                        {% elif achievement.category == 'CODING' %}üíª
                        {% else %}üéì{% endif %}
                    </div>
                    <div>
                        <h6 class="fw-bold mb-0">{{ achievement.title }}</h6>
                        <span class="badge bg-success-subtle text-success small">{{ achievement.get_category_display }}</span>
                        {% if achievement.achieved_on %}<small class="text-muted ms-2">{{ achievement.achieved_on|date:"M Y" }}</small>{% endif %}
                        {% if achievement.proof_url %}<a href="{{ achievement.proof_url }}" target="_blank" class="btn btn-sm btn-outline-secondary ms-2" style="font-size:.75rem;padding:2px 8px;">View Proof</a>{% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Recent Posts -->
            {% if posts %}
            <div class="card p-4">
                <h5 class="fw-bold mb-3"><i class="bi bi-chat-square-text me-2"></i>Recent Posts</h5>
                {% for post in posts %}
                <div class="mb-3 pb-3 border-bottom">
                    <p class="mb-1">{{ post.content|truncatewords:30 }}</p>
                    <div class="d-flex gap-2">
                        <span class="domain-badge domain-{{ post.domain_tag }}">{{ post.domain_tag }}</span>
                        <small class="text-muted">{{ post.created_at|date:"M d, Y" }}</small>
                        <small class="text-muted"><i class="bi bi-heart me-1"></i>{{ post.like_count }}</small>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
