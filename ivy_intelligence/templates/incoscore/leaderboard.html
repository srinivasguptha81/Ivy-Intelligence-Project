{% extends 'base/base.html' %}
{% block title %}InCoScore Leaderboard ‚Äî Ivy Intelligence{% endblock %}
{% block content %}
<div class="container py-4" style="max-width: 900px;">
    <div class="text-center mb-5">
        <h2 class="fw-bold" style="color: var(--ivy-blue);">üèÜ InCoScore Leaderboard</h2>
        <p class="text-muted">Top students ranked by Intelligent Competency Score</p>
    </div>

    {% if top_students %}
    <!-- Top 3 podium -->
    <div class="row justify-content-center g-3 mb-5">
        {% for profile in top_students|slice:":3" %}
        <div class="col-md-4 text-center">
            <div class="card p-4" style="border-top: 4px solid {% if forloop.first %}#f0a500{% elif forloop.counter == 2 %}#9ca3af{% else %}#b45309{% endif %};">
                <div style="font-size:2rem;">{% if forloop.first %}ü•á{% elif forloop.counter == 2 %}ü•à{% else %}ü•â{% endif %}</div>
                <div style="width:60px;height:60px;background:var(--ivy-blue);border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:1.5rem;font-weight:700;margin:0.5rem auto;">
                    {{ profile.user.username.0|upper }}
                </div>
                <h5 class="fw-bold mb-0">{{ profile.user.username }}</h5>
                <p class="text-muted small mb-1">{{ profile.university|truncatewords:3 }}</p>
                <div class="score-ring" style="width:70px;height:70px;font-size:1.2rem;border-width:5px;margin:0.5rem auto;">{{ profile.incoscore|floatformat:1 }}</div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Full table -->
    <div class="card">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead style="background: var(--ivy-blue); color: white;">
                    <tr>
                        <th class="ps-4">Rank</th>
                        <th>Student</th>
                        <th>University</th>
                        <th>Domains</th>
                        <th>CGPA</th>
                        <th>InCoScore</th>
                    </tr>
                </thead>
                <tbody>
                    {% for profile in top_students %}
                    <tr {% if profile.user == request.user %}style="background:#fef9c3;"{% endif %}>
                        <td class="ps-4 fw-bold text-muted">#{{ forloop.counter }}</td>
                        <td>
                            <a href="{% url 'profile_view' profile.user.username %}" class="text-decoration-none text-dark fw-bold">
                                {{ profile.user.username }}
                            </a>
                            {% if profile.user == request.user %}<span class="badge bg-warning text-dark ms-1">You</span>{% endif %}
                        </td>
                        <td class="small text-muted">{{ profile.university|default:"‚Äî"|truncatewords:4 }}</td>
                        <td>
                            {% for d in profile.domains_of_interest|slice:":2" %}
                            <span class="domain-badge domain-{{ d }}">{{ d }}</span>
                            {% endfor %}
                        </td>
                        <td class="small">{{ profile.cgpa|default:"‚Äî" }}</td>
                        <td>
                            <div class="d-flex align-items-center gap-2">
                                <div class="progress flex-grow-1" style="height:6px; min-width:60px;">
                                    <div class="progress-bar bg-warning" style="width: {{ profile.incoscore }}%;"></div>
                                </div>
                                <strong>{{ profile.incoscore|floatformat:1 }}</strong>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="text-center py-5">
        <i class="bi bi-trophy" style="font-size:3rem;color:#ccc;"></i>
        <h5 class="mt-3 text-muted">No scores yet</h5>
        <p class="text-muted">Add and verify achievements to appear on the leaderboard.</p>
        <a href="{% url 'account_signup' %}" class="btn btn-primary">Join Now</a>
    </div>
    {% endif %}
</div>
{% endblock %}
